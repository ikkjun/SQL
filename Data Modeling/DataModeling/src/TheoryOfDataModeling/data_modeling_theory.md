# 01. 데이터 모델링 이론
## 데이터 모델링이란
데이터 모델링은 업무에서 사용하는 각종 데이터를 구축하고자 하는 시스템의 데이터베이스에 기록하여 지속적으로 관리하고 활용하기 위해 데이터를 구조화하고 형상화하는 과정이다.
일반적으로 ER모델(Entity-Relationship Model)을 통해 데이터 모델링을 수행하며, 관계형 모델과 관계형 데이터베이스를 통해 데이터를 저장하고 관리한다.

### ER 모델
ERD(Entity-Relationship Diagram)는 ER모델에서 사용하는 실체와 관계를 도식화한 것이다.
- 큰 테이블을 쪼갤 수 있을만큼 쪼개는 것을 정규화라고 한다.
- 실행중에 테이블을 붙이는 것을 join이라고 한다.
  - join을 하면 중복 데이터가 생겨도 괜찮다.
- 테이블을 너무 쪼개서 다시 붙이는 것이 역졍규화이다.

### ER 모델의 질적 특성
- 완전성
- 정확성
- 최소성
- 자명성
- 확장성
- 표현성
- 가독성

## ER 모델 구성 요소
ER 모델의 구성요소로는 엔티티(Entity), 관계(Relationship), 속성(Attribute)이 있다. 
속성과 관계 중 하나 이상의 조합으로 구성된 식별자(Identifier)를 포함한다.
일단 엔티티를 만들고 관계를 맺어주는 것이다.

### 엔티티
엔티티는 현실 세계에 실제로 존재하는 실체이거나, 조직, 서비스처럼 개념적인 것이다(≒ 클래스).

### 관계
관계는 관계수(cardinality), 선택성(optionality), 식별성(Identifier Inheritance), 관계명 등으로 구성된다.

|구성요소| DA#(Barker 표기)                                  |ERwin(IE표기)|
|---|-------------------------------------------------|---|
|관계수| 아무런 표시가 없으면 1, Crow's feet(<)이면 M               |Bar(-)이면 1, Crow's feet(<)이면 M|
|선택성| 점선이면 Optional, 실선이면 Mandatory                   |Bar(-)이면 Mandatory, O이면 Optional|
|식별자 상속| Bar(-)가 있으면 식별자 상속, 없으면 비식별자 상속                 |실선이면 식별자 상속, 점선이면 비식별자 상속|

#### 관계수
일대일(1:1), 일대다(1:M), 다대다(M:N) 3가지 유형이 있다.
- 일대일 관계
  - 실제 일대일 관계는 많이 발생하지 않는다.
  - 예시
    - 직원과 인턴의 관계
      - 직원은 한 번의 인턴과정을 거쳐 채용될 수 있으며, 하나의 인턴과정은 하나의 직원과 관련이 있다.
    - 보안
    - 성능
- 일대다 관계
  - 하나의 부서에 직원 여러 명이 소속되어 있으며, 직원은 한 부서에 소속될 수 있다.
  - 관계를 볼 때는 한 쪽만 보면 안 되고, 양쪽을 봐야 한다.
- 다대다 관계
  - 데이터에 중복이 생기므로 바람직하지 못하므로, 나중에 관계를 해소해야 한다. 다만 join을 했을 때 발생하는 중복은 괜찮다.
  - 잘못된 것은 아니지만, 일단 표현을 하고 나중에 관계를 수정해야 한다.
  - 여러 명의 학생은 여러 개의 과목을 신청할 수 있다.

#### 선택성(케이스 암기)
- 필수 - 필수 관계 </br> 상품을 선택하지 않고 주문을 하는 경우는 없으므로, 주문은 주문상품이 반드시 존재해야 한다. 반대로 주문상품도 주문이 반드시 존재해야 한다.
- 필수 - 선택 관계 </br> 주문하지 않은 고객은 있을 수 있으나, 주문은 반드시 주문한 고객이 있어야 한다.
- 선택 - 선택 관계 </br> 소개 사원으로 등록된 계좌가 존재하지 않을 수 있고, 고객이 펀드 상품에 가입할 때 소개 사원을 지정하지 않아도 되므로 계좌는 소개 사원이 존재하지 않을 수 있다. 

#### 식별자 상속
- PK가 다른 테이블의 키로 들어가는 것이다.
- 식별자 관계: PK이면서 FK인 관계
- 긴밀한 관계에서 식별자 상속이 일어난다.
- 고객주소 table은 고객 table의 일부이므로 고객의 키를 물려받으면서 PK가 상속된다. 주문 table은 고객 table과 관계가 깊지 않다.

##### 관계 유형
- 기본관계: 엔티티와 엔티티가 하나의 관계를 맺는다. 가장 일반적인 관계이며, 1:1 또는 1:M 관계에 해당한다.
- 재귀적 관계: 하나의 엔티티가 다른 자기 자신과 관계를 맺는 경우이다(self-join). 재귀적 관계는 Mandatory 관계를 가질 수 없으며, 반드시 Optional 관계를 갖는다.
- 병렬관계: 엔티티와 엔티티 간에 두 개 이상의 관계를 맺는다. 고객은 보험계약의 계약자이면서 피보험자이기도 하다.
- 슈퍼타입/서브타입 관계: 공통 속성을 관리하는 슈퍼타입 엔티티와 개별속성을 관리하는 서브타입 엔티티는 배타적/포괄적인 관계를 가진다.

### 속성(≒ java: iv, table: 컬럼)
속성은 데이터를 표현하는 가장 작은 단위이다.
#### 구성요소
- 속성명: 실체의 특성을 규정하는 속성 명칭으로 주문번호, 주문일자 등이다.
- 식별자 여부: 해당 속성이 엔티티 식별자에 해당하는지 표시한다.
- 옵셔널리티: 엔티티에 인스턴스가 발생할 때 해당 속성이 반드시 특정 값을 가져야 하는지에 대한 구분으로 Mandatory, Optional, Conditional(특정 조건에 해당하는 경우에는 반드시 값을 가져야 한다; NOT NULL)로 구분된다.
- 도메인: 속성이 허용하는 데이터 형식(타입)과 범위를 가지고 있다.
#### 분류
- 단순 속성(Simple Attribute)과 복합 속성(Composite Attribute)
  - 단순 속성은 속성을 더 분해할 수 없는 원자 값을 갖는다(자바: 변수).
  - 복합 속성은 단순 속성들의 조합으로 구성된다(참조값).
- 저장 속성(Stored Attribute)과 파생 속성(Derived Attribute)
  - 저장 속성은 원래 존재하는 속성이다.
  - 파생 속성은 저장 속성이나 다른 파생 속성으로부터 파생된 속성이다.
- 단일 값(Single-valued) 속성과 다중 값(Multi-valued) 속성
  - 단일 값 속성은 하나의 값만 가지는 속성을 의미한다(변수).
  - 다중 값 속성은 하나의 속성이 여러 개의 값을 가지는 속성을 말한다(배열)
  - 값을 저장하는 방식
    1. 
    | 취미 | 
    |---|
    |수영, 독서, 캠핑| </br> 꺼내서 잘라야 한다. count와 같은 DB 기능을 쓰기 어렵다. ex) 해시태그
    2. 
    |취미1|취미2|취미3|
    |---|---|---|
    |수영|   |   |
    |수영|독서|캠핑|
      취미 개수 고정
    3. 취미 table
    
    |id|취미|
    |---|---|
    |aaa|수영|
    |bbb|독서|
    |bbb|조깅|
     취미 개수 동적으로 변한다.
### 식별자
식별자의 특징으로 유일성(UNIQUE), 최소성, 불변성, 존재성(NOT NULL)이 있다.
- 본질 식별자: 실 세계(업무)에서 일반적으로 통용되는 식별자
- 인조 식별자: 업무에서 사용하지 않지만, 데이터를 효율적으로 관리하기 위해 별도로 추가한 식별자이다.</br>
인조식별자를 쓰는 이유는? </br>주문 상품에 따라 가격이 달라질 수 있기 때문이다.

## 관계형 데이터 모델 이론
관계형 데이터 모델은 데이터를 2차원 테이블(표) 형식으로 정의하고 표현한 모델이다.

### 관계형 모델의 키
- 슈퍼 키: 튜플을 고유하게 식별할 수 있는 속성 집합을 말한다.
- 후보 키: 튜플을 고유하게 식별할 수 있는 최소한의 속성 집합을 후보키라고 한다.
- 기본 키: 릴레이션은 하나 이상의 후보 키가 있을 수 있으며 그 중 하나만을 기본키로 선택할 수 있다.
- 대체 키: 후보 키 중에 기본키가 아닌 후보 키가 대체 키에 해당한다.
- 외래 키: 어떤 릴레이션의 어트리뷰트 값이 다른 릴레이션에 속한 어트리뷰트의 기본 키를 참조하는 경우를 말한다.

### 제약 조건
- 키 제약조건: UNIQUE
- 무결성 제약조건
  - 실체 무결성: NOT NULL
  - 영역 무결성: 릴레이션 내의 각 어트리뷰트 값은 반드시 정의된 도메인에 속한 값이어야 한다.
  - 참조 무결성: FK

### 함수 종속
관계형 데이터모델은 수학의 집합론(Set Theory)에서 유래했다(→ 중복x).
- 완전 함수 종속: 임의의 릴레이션 R에서 속성 또는 속성들의 집합 X에 대해 Y가 함수적으로 종속되나, X의 부분 집합에 대하여는 함수적으로 종속하지 않은 경우, Y는 X에 대하여 완전 함수 종속성을 갖는다고 할 수 있다.
- 부분 함수 종속: 여러 개의 속성이 모여서 하나의 기본키를 이룰 경우, 기본키를 구성하는 일부 속성만으로도 종속관계가 결정되는 것이다.
- 이행적 함수 종속: 함수 종속관계 X → Y, Y → Z가 성립되면, 논리적으로 X → Z가 성립한다. 이 때 속성 Z는 X에 이행적 함수 종속성을 갖는다.

### 정규화
이상 현상을 줄이기 위해 table을 쪼개서 중복을 제거하는 것이다.
정규화를 너무 심하게 할 경우(너무 작게 쪼개는 경우) 응용 프로그램에서 Join이 빈번하게 발생하여 성능이 저하될 수 있다. 
이 경우 반정규화(역정규화)를 통해 문제를 해결해야 한다. 
그러나 반정규화는 성능 문제를 초래할 수 있으므로 제한적으로 사용해야 한다.

#### Join과 역정규화의 차이점
Join은 실행시에 테이블을 붙이는 것이지만, 역정규화는 설계 레벨에서 테이블을 붙이는 것이다.

#### 제1정규형
- 컬럼 원자성
- 테이블은 중복되는 행이 없어야 하고, 모든 열의 값은 원자 값을 가져야 한다.

#### 제2정규형
- 제1정규형 만족, 부분 종속 해소

#### 제3정규형
- 제2정규형 만족, 이행 종속 해소


